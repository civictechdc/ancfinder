<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>DC 2013 Wards, ANCs, and SMDs</title>

	<!-- styles -->
	<link href="static/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
	<link href="static/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
	<link href="static/css/theme.css" rel="stylesheet">
	
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body onload="initialize()">
	<div id="header"> <!-- doesn't use bootstrap's navbar styling, ought to fix this -->
  		<div class="container">
	  		<div class="row">
	  			<a href="index.html" id="logo" class="span2">ANC Brigade</a>
	  			<div class="span10">
	  				<ul class="nav-links">
              <li><a class="smooth" href="#what-is-an-anc" title="Discover what ANCs do for DC.">What Are ANCs?</a></li>
			  <!--<li><a href="map.html" title="Which ANC distict do you live in? Who is your Commissioner? Learn that and more here.">Find My ANC</a></li>-->
              <li><a href="share.html" title="We're all in this together. You can submit any kind of info about an ANC here, such as meeting minutes, budget info, Commissioner websites, etc.">Submit ANC Info</a></li>
              <li><a href="about.html" title="This is a project of Code for DC, a group of volunteer civic hackers. Learn more and get involved!">About Us</a></li>
	  				</ul>
	  			</div>
	  		</div>
	  	</div>
    </div><!-- /header -->

    <div id="masthead">
    	<div class="container">
    		<div class="row">
    			<div class="span10 offset1">
    				<h1><a class="smooth" href="#what-is-an-anc">What is an ANC? Give me the tour! <span style="margin-left: .5em">▶</span></a></h1>
    			</div>
    		</div>
    	</div>
    </div>
	<div class="main widecontainer style2">
	<div class="container">
		<div class="row">
			<div class="span5 offset1">
			
			<div id="intro">
				<h3>Find Your ANC</h3>
				<p style="margin-bottom: 1em">Washington DC is divided into 40 districts called Advisory Neighborhood Commissions, or ANCs.</p>
				<p>Let&rsquo;s find yours. Enter your home address to get started:</p>
			</div>
			<div id="addr_box">
				<input id="addr" type="text"/>
				<div>Washington, DC</div>
				<input type="button" onclick="do_address()" value="Find Out About My ANC ▶"/>
				<div id="use_my_location"><a href="#" onclick="use_my_location(); return false;">Use my current location</a></div>
			</div>
			
			<!--If search successful, details below-->
			<div id="info" style="display: none; margin-top: 1em;">
				<div>
					<p>You live in <b>Ward <span class="ward-name"> </span>&rsquo;s ANC <span class="anc-short-name"> </span></b>.
					It&rsquo;s called <span class="anc-name"> </span> for short.</p>
					
					<p>Your single member district is <b><span class="smd-name"> </span></b>.</p>
					
					<p>Your commissioner is: <b><span class="smd-commissioner"> </span></b><span class="smd-commissioner-email"></span>.</p>

					<p class="anc-has-website">ANC <span class="anc-name"> </span>&rsquo;s website is <a class="anc-website"> </a>.
					
    				<p style="margin-top: 1.5em"><a class="smooth" href="#what-is-an-anc">Learn more about ANCs <span>▼</span></a></p>
					
					</div>
			</div>
			<!--Search unsuccessful-->
			<div id="info_address_not_found" style="display: none">
				We could not find your address, sorry!
			</div>
			
		  </div>
		  
		  <div id="map_col" class="span5">
			<div id="map_canvas_google" class="map" style="width: 400px; height: 340px; margin-top: 30px;"> </div>
		  </div>
		</div>
	</div>
	</div>
	</div>
	
	<div id="what-is-an-anc" class="widecontainer style1">
	<div class="container">
		<div class="row">
			<div class="span5 offset1 text">
				<h2>What is an ANC?</h2>
				<p class="what-is-it">Washington DC is divided into 40 districts called Advisory Neighborhood Commissions, or ANCs.</p>
				<p class="how-many-commissioners">ANCs are lead by an average of 2-12 commissioners who make decisions about a broad range of issues in your community, such as liquor licenses, parking, and sanitation.</p>
				<div id="commissioners"> </div>
				<p>This is your most local form of government. <span class="anc-has-website" style="display: none">Check out your ANC&rsquo;s website at <a class="anc-website"> </a>.</span></p>
			</div>
			<div class="span5 image">
				<img src="static/img/anc.svg"/>
			</div>
		</div>
	</div>
	</div>

	<div class="widecontainer style2">
	<div class="container">
		<div class="row">
			<div class="span5 offset1 image">
				<img src="static/img/neighborhood.svg"/>
			</div>
			<div class="span5 text">
				<h2>Single Member Districts</h2>
				<p>Each ANC has 2-12 ANC commissioners who each represent a division of the ANC called a Single Member District, or SMD. Commissioners each represent about 2,000 DC residents who live in the SMD.</p>
				<p class="has-commissioner" style="display: none">Your commissioner in <span class="smd-name"> </span> is <span class="smd-commissioner"> </span><span class="smd-commissioner-email"></span>.</p>
			</div>
		</div>
	</div>
	</div>
 
	<div class="widecontainer style1">
	<div class="container">
		<div class="row">
			<div class="span5 offset1 text">
				<h2>What do ANCs do? Why should I care?</h2>
				<p>ANCs hold regular meetings and make decisions to advise the DC Council and government about many important community issues, such as parking, recreation, street improvements, liquor licenses, zoning, restaurants and businesses, police protection, sanitation and trash collection, and the District's annual budget. Although ANCs can only offer advisory opinions in many matters, their recommendations are influential and can become the final decision, either in whole or in part.</p>
				<p>Your ANC commissioners also control grant money of several thousand dollars (or more) for the general purpose of improving their area and hiring staff. <a href="authority.html">Learn more about ANC authority and budget.</a></p>
			</div>
			<div class="span5 image">
				<img src="static/img/people.svg"/>
			</div>
		</div>
	</div>
	</div>
 
	<div class="widecontainer style2">
	<div class="container">
		<div class="row">
			<div class="span5 offset1 image">
				<img src="static/img/vote.svg"/>
			</div>
			<div class="span5 text">
				<h2>Who elects ANC commissioners?</h2>
				<p>You elect your ANC commissioner every two years in non-partisan elections. ANC commissioners each represent one single member district (SMD). ANC campaigns are typically small, grassroots efforts. In fact, winning candidates often run unopposed and receive just a few hundred votes. <a href="elections.html">Learn more about ANC elections.</a></p>
			</div>
		</div>
	</div>
	</div>

	<div class="widecontainer style1">
	<div class="container">
		<div class="row">
			<div class="span5 offset1 text">
				<h2>How can I get involved?</h2>
				<p>To get involved in your ANC, you can attend ANC meetings, learn more about your ANC, or even become an ANC Commissioner. <a class="smooth" href="#intro">Start by finding your ANC.</a></p>
			</div>
			<div class="span5 image">
				<img src="static/img/hand.svg"/>
				
				<div id="jump_to_top">
					<a href="#">Jump to the top ▴</a>
				</div>
			</div>
		</div>
	</div>
	</div>

    <footer>
        <div class="row">
          <div class="span3 offset2">
                <p>ANCBrigade is a project in Washington, D.C. to strengthen our unique hyper-local level of government called Advisory Neighborhood Commissions (ANCs).</p>
          </div>
          <div class="span3 offset">
              <p class="by">ANCBrigade is a project of the <a href="http://codefordc.org/">Code for DC</a>. We’re volunteers interested in using technology to solve problems in our civic lives. This is a work in progress.</p>
          </div>
          <div class="span3">
              <p>Last updated June 2, 2013.
              <br>
              <a href="https://github.com/codefordc/ancbrigade">Source code on github</a>.</p>
          </div>
        </div>
    </footer>
    
	<!-- jQuery, Bootstrap, and Google Maps -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"> </script>
	<script src="static/bootstrap/js/bootstrap.min.js"></script>
	<script src="static/jquery-utils.js"> </script>
	
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<script type="text/javascript" src="http://gis.govtrack.us/static/js/google_maps_helpers.js"></script>
	<script type="text/javascript" src="http://gis.govtrack.us/static/js/maps_helpers.js"></script>

	
	<script type="text/javascript">
		function initialize() {
			$('#map_col').css({ height: $('#map_col').width() * 3.5/4 });
			var h = $(window).height() - $('.widecontainer.main').offset().top*2;
			$('.widecontainer.main').css({ minHeight: h });

			var w = $(window).width()/2 - 100;
			if (w > 400) $('#map_canvas_google').css({ width: w });
			if (h-100 > 340) $('#map_canvas_google').css({ height: h-100 });
			
			initialize_google();
			
			$('#addr').keydown_enter(do_address);
			$('#addr').input_default("1818 H St. NW");
			
			if (navigator.geolocation) $('#use_my_location').show();
			
			$('a.smooth').click(function(e) {
				e.preventDefault();
				var target = this.hash,
				$target = $(target);
				$('html, body').stop().animate({
					'scrollTop': $target.offset().top - 15
				}, 900, 'swing', function () {
					window.location.hash = target;
				});
				return false;
			});
			
			$('#jump_to_top a').click(function(e) {
				e.preventDefault();
				$('html, body').stop().animate({
					'scrollTop': 0
				}, 900, 'swing', function () {
					window.location.hash = "#";
				});
				return false;
			});
		}
	
		/*** FOR GOOGLE MAPS API V3 ***/
		function initialize_google() {
			// Create a basic roadmap centered on the United States.
			var myOptions = {
				zoom: 4,
				center: new google.maps.LatLng(38, -96),
				mapTypeId: google.maps.MapTypeId.ROADMAP,
				panControl: false,
				zoomControl: true,
				mapTypeControl: false,
				scaleControl: true,
				streetViewControl: false,
				styles: [ { "featureType": "poi.park", "elementType": "geometry.fill", "stylers": [ { "visibility": "off" } ] } ]
				};
			map = new google.maps.Map(document.getElementById("map_canvas_google"), myOptions);
			
			map.fitBounds(new google.maps.LatLngBounds(
				new google.maps.LatLng(38.869472385, -77.1014200414),
				new google.maps.LatLng(38.9613165232, -76.923349042)));
			
			map.overlayMapTypes.clear();
			add_overlay(map, "dc-ward-2013", 8, 12);
			//add_overlay(map, "dc-ward-2013-outlines", 13, 20);
			add_overlay(map, "dc-anc-2013", 13, 14);
			add_overlay(map, "dc-anc-2013-outlines", 15, 20);
			add_overlay(map, "dc-smd-2013-outlines", 13, 14);
			add_overlay(map, "dc-smd-2013", 15, 20);
		}

		// Add a tile overlay for this layer.
		function add_overlay(map, layer, minzoom, maxzoom, opacity) {
			if (!opacity) opacity = 1.0;
			var tileimgformat = 'png';
			if (navigator.appName == 'Microsoft Internet Explorer' && new RegExp("MSIE [678]").exec(navigator.userAgent)) tileimgformat = 'gif';
			
			var overlay = new google.maps.ImageMapType({
			  getTileUrl: function(coord, zoom) {
				  if (maxzoom && zoom > maxzoom) return null; // minZoom, maxZoom ineffectual below?
				  if (minzoom && zoom < minzoom) return null;
				  return "http://gis.govtrack.us/map/tiles/" + layer + "/" + zoom + "/" + coord.x + "/" + coord.y + "." + tileimgformat + "?gen=8";
			  },
			  tileSize: new google.maps.Size(256, 256),
			  isPng: tileimgformat == 'png',
			  
			  minZoom: minzoom,
			  maxZoom: maxzoom,
			  opacity: (tileimgformat == 'png' ? .8 : .25) * opacity
			});
			map.overlayMapTypes.insertAt(0, overlay);
		}
		
		
		var anc_data = null;
		$.ajax({
			url: "ancs.json",
			dataType: "json",
			success: function(data) {
				anc_data = data;
			}
		});

		var location_marker = null;
		function use_my_location() {
			navigator.geolocation.getCurrentPosition(
				function(position) {
					if (!position || !position.coords) return;
					$('#addr').val("your current location");
					show_info(position.coords.latitude, position.coords.longitude);
					
					if (location_marker) map.removeOverlay(location_marker);
					location_marker = new google.maps.Marker({
						map: map,
						position: new google.maps.LatLng(
							position.coords.latitude,
							position.coords.longitude
							),
						title: "Your Current Location"
						});
				},
				function(position) {
					alert("We couldn't get your current location.");
				}
			);
		}

		var geocoder;
		function do_address() {
			var addr = $('#addr').val() + ", Washington, DC";
			if (!geocoder) geocoder = new google.maps.Geocoder();
			geocoder.geocode(
				{
					'address': addr,
					'bounds': new google.maps.LatLngBounds(new google.maps.LatLng(23.471824072761766, -97.75457204169999), new google.maps.LatLng(51.6101792052535, -56.27019704169999)),
					'language': 'en',
					'region': 'us'
				},
				function(results, status) {
					if (status == google.maps.GeocoderStatus.OK) {
						var geocoder_result = results[0].geometry.location;
						show_info(geocoder_result.lat(), geocoder_result.lng());
					}
				}
				);
		}
		
		function show_info(lat, lng) {
						$.ajax({
							url: "http://gis.govtrack.us/boundaries/dc-smd-2013/?contains=" + lat + "," + lng,
							dataType: "jsonp",
							success: function(data) {
								if (data.objects.length == 0) {
									// Not found!
									$('#info').fadeOut();
									$('#info_address_not_found').fadeIn();
									return;
								}
								
								$('#intro').slideUp();
								
								data = data.objects[0];

								var smd_id = data.external_id.toUpperCase();
							
								var ward = anc_data[smd_id.substring(0,1)];
								var anc = ward["ancs"][smd_id.substring(1,2)];
								var smd = anc["smds"][smd_id.substring(2,4)];
								
								var boundsarray = anc.bounds;
								var sw = new google.maps.LatLng(boundsarray[1], boundsarray[0]);
								var ne = new google.maps.LatLng(boundsarray[3], boundsarray[2]);
								var bounds = new google.maps.LatLngBounds(sw, ne);
								map.fitBounds(bounds);
								map.overlayMapTypes.clear();
								add_overlay(map, "dc-anc-2013/" + smd_id.toLowerCase().substring(0, 2), null, null, .75);
								add_overlay(map, "dc-smd-2013/" + smd_id.toLowerCase());
								
								$(".smd-name").text(smd.smd);
								$(".ward-name").text(ward.ward);
								$(".anc-short-name").text(anc.anc_letter);
							
								$(".anc-name").text(anc.anc);
								$(".anc-website").text(anc.website);
								$(".anc-website").attr('href', anc.website);
								$(".anc-has-website").toggle(anc.website);
								
								$('.has-commissioner').show();
								var name = "";
								name += smd["First Name"] + " ";
								if (smd["Nickname"]) name += smd["Nickname"] + " ";
								if (smd["Middle Name"]) name += smd["Middle Name"] + " ";
								name += smd["Last Name"];
								$(".smd-commissioner").text(name);
								
								if (smd.Email || smd.Phone) {
									var contacts = [];
									if (smd.Email) contacts.push(smd.Email);
									if (smd.Phone) contacts.push(smd.Phone);
									$('.smd-commissioner-email').text(" (" + contacts.join(", ") + ")");
								} else {
									$('.smd-commissioner-email').text(" (contact information was not provided)");
								}
								
								$('#map_col').show();
								$('#info').fadeIn();
								$('#info_address_not_found').fadeOut();
								
								$('#what-is-an-anc h2').text("What is ANC " + anc.anc + "?");
								$('#what-is-an-anc .what-is-it').text(anc.anc + " is one of Washington DC’s 40 Advisory Neighborhood Commissions.");  
								$('#what-is-an-anc .how-many-commissioners').text("Your ANC is lead by " +  Object.keys(anc["smds"]).length + " commissioners who make decisions about a broad range of issues in your community, such as liquor licenses, parking, and sanitation.");
								/*$('#commissioners').text('');
								$('#commissioners').append($('<p>Your commissioners in ' + anc.anc + " are:</p>"));
								var ul = $("<ul/>");
								$('#commissioners').append(ul);
								for (s in anc["smds"]) {
									var ss = anc["smds"][s];
									var li = $('<li>/').text(ss.smd + ": " + ss["First Name"] + " " + ss["Last Name"]);
									ul.append(li);
								}*/
							}
						}); // ajax to resolve SMD
		}			
	</script>
	
</body>
</html>
